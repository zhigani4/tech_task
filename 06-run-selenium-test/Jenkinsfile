#!/usr/bin/env groovy

pipeline {
    agent any
    environment {
        COUNT_NODES   = "${params.COUNT_NODES}"
        COUNT_THREADS = "${params.COUNT_THREADS}"
        DRIVER_HOST   = "${params.DRIVER_HOST}"
    }
    stages {
       stage('Build and run selenium pytest') {
          steps{
              script {
                  currentBuild.displayName = "Build_Name_count_nodes_$COUNT ${env.BUILD_NUMBER}"
                  currentBuild.description = "Build run with $COUNT threads test to $DRIVER_HOST grid."
                  dir("${env.WORKSPACE}/06-run-selenium-test"){
                    sh "docker build -t app_docker ."
                    sh "docker run -e COUNT_NODES=${COUNT_NODES} -e COUNT_THREADS=${COUNT_THREADS} -e DRIVER_HOST=${DRIVER_HOST} -v /var/run/docker.sock:/var/run/docker.sock -ti app_docker:latest" 
               }
            }
          }
       }
    }
}


